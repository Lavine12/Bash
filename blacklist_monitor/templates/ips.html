{% extends 'base.html' %}
{% block content %}
<h1>IP Addresses</h1>
<form method="post">
    <input type="text" name="ip" placeholder="IP or CIDR range" required>
    <select name="group_id">
        <option value="">No Group</option>
        {% for g in groups %}
        <option value="{{ g[0] }}">{{ g[1] }}</option>
        {% endfor %}
    </select>
    <input type="submit" value="Add">
</form>
<h2>Bulk Add</h2>
<form method="post" action="{{ url_for('bulk_ips') }}">
    <textarea name="ips_bulk" rows="4" cols="40" placeholder="one IP or CIDR per line"></textarea>
    <br>
    <select name="group_id">
        <option value="">No Group</option>
        {% for g in groups %}
        <option value="{{ g[0] }}">{{ g[1] }}</option>
        {% endfor %}
    </select>
    <input type="submit" value="Add List">
</form>
<form method="post" id="group-form" action="{{ url_for('set_group') }}">
    <select name="group_id">
        {% for g in groups %}
        <option value="{{ g[0] }}">{{ g[1] }}</option>
        {% endfor %}
    </select>
    <input type="submit" value="Set Group">
    <table>
        <tr><th></th><th>IP</th><th>Group</th><th>Action</th></tr>
        {% for ip in ips %}
        <tr>
            <td><input type="checkbox" name="ip_id" value="{{ ip[0] }}"></td>
            <td>{{ ip[1] }}</td>
            <td>
                {% for g in groups %}
                    {% if g[0] == ip[2] %}{{ g[1] }}{% endif %}
                {% endfor %}
            </td>
            <td>
                <form method="post" action="{{ url_for('delete_ip', ip_id=ip[0]) }}">
                    <button type="submit">Delete</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>
</form>
{% endblock %}
